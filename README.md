# Ília Digital – Node.js Challenge

## Overview

The system is composed of two independent Node.js microservices:

- **Users Service (Port 3002)**  
  Responsible for user registration, authentication, and user management.

- **Wallet Service (Port 3001)**  
  Responsible for managing financial transactions (credit and debit) and wallet balance.

Both services communicate securely using **JWT**, run with **Docker**, and persist data in **PostgreSQL**.

---

## Architecture

- Microservices architecture
- RESTful APIs
- PostgreSQL database per service
- JWT-based authentication
- Docker and Docker Compose orchestration
- Explicit separation of concerns (controllers, services, repositories)

```
├── users-service
│   ├── src
│   │   ├── modules
│   │   │   └── users
│   │   ├── database
│   │   ├── config
│   │   └── middlewares
│   └── Dockerfile
│
├── wallet-service
│   ├── src
│   │   ├── modules
│   │   │   └── wallet
│   │   ├── database
│   │   └── config
│   └── Dockerfile
│
├── docker-compose.yml
└── README.md
```

---

## Technologies

- Node.js 18+
- TypeScript
- Fastify
- PostgreSQL
- Docker & Docker Compose
- JWT (`@fastify/jwt`)
- bcrypt
- Kafka (event-based communication)

---

## Running the Project

### Prerequisites

- Docker
- Docker Compose

### Start all services

```bash
docker-compose up --build
```

### Stop everything

```bash
docker-compose down
```

### Remove volumes (database reset)

```bash
docker-compose down -v
```

---

## Authentication

Authentication is based on JWT:

- Public endpoints do not require a token
- Protected endpoints require:

```
Authorization: Bearer <JWT_TOKEN>
```

JWT is generated by the Users Service and reused by the Wallet Service.

---

## API Endpoints

### Users Service – `http://localhost:3002`

#### Public

```http
POST /users
POST /auth
```

Example – Create User:

```json
{
  "user": {
    "first_name": "Armando",
    "last_name": "Salvador",
    "email": "Armando@Salvador.com",
    "password": "123456789"
  }
}
```

Example – Login:

```json
{
  "user": {
    "email": "Armando@Salvador.com",
    "password": "123456789"
  }
}
```

#### Protected

```http
GET /users
GET /users/:id
PATCH /users/:id
DELETE /users/:id
```

---

### Wallet Service – `http://localhost:3001`

All wallet endpoints require authentication.

```http
POST /transactions
GET /transactions
GET /balance
```

Example – Create Transaction:

```json
{
  "user_id": "userid",
  "type": "CREDIT",
  "amount": 100
}
```

---

## Databases

Each service has its own PostgreSQL database:

- **Users DB**: port `5433`
- **Wallet DB**: port `5434`

Data persistence is handled via Docker volumes.

---

## Kafka Integration

- The Users Service publishes user creation events
- The Wallet Service can react to these events if needed
- Kafka is fully containerized and runs with Zookeeper

